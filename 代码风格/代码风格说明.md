# 代码风格说明  
  
## 头文件说明  

1. 头文件中适合放置接口的声明，不适合放置实现  
2. 头文件应当职责单一  
3. 头文件应向稳定的方向包含  
4. 每一个.c文件应有一个同名.h文件，用于声明需要对外公开的接口  
5. .c/.h文件禁止包含用不到的头文件  
6. 总是编写内部#include保护符（#define保护）  
7. 禁止在头文件中定义变量  
8. 只能通过包含头文件的方式使用其他.c提供的接口，禁止在.c中通过extern的方式使用外部函数接口、变量  

## 函数说明  

1. 一个函数仅完成一件功能  
2. 重复代码应该尽可能提炼成函数  
3. 可重入函数应避免使用共享变量；若需要使用，则应通过互斥手段（关中断、信号量）对其加以保护
4. 对参数的合法性检查，统一规定由接口函数负责
5. 设计高扇入，合理扇出（小于7）的函数  
*说明：扇出是指一个函数直接调用（控制）其它函数的数目，而扇入是指有多少上级函数调用它*  
6. 废弃代码（没有被调用的函数和变量)要及时清除  
7. 函数不变参数使用const  
8. 函数的参数个数不超过5个  
9. 在源文件范围内声明和定义的所有函数，除非外部可见，否则应该增加static关键字  

## 标识符命名与定义  

标识符的命名要清晰、明了，有明确含义，同时使用完整的单词或大家基本可以理解的缩写，避免使人产生误解。除了常见的通用缩写以外，不使用单词缩写，不得使用汉语拼音。尽量避免名字中出现数字编号，除非逻辑上的确需要编号  

### 通用命名规则  

1. 所有变量，函数使用下划线命名法，所有单词均为小写  
2. 尽量避免命名中出现数字编号，除非逻辑上的确需要编号  
3. 标识符前不应添加模块、项目、产品、部门的名称作为前缀  
4. 重构/修改部分代码时，应保持和原有代码的命名风格一致  

### 文件名命名规则  

文件命名统一采用小写字符，中间以"_"隔开  

### 变量命名规则  

1. 全局变量应增加“g_”前缀  
2. 静态变量应增加“s_”前缀  

### 宏定义的命名规则  

1. 对于数值或者字符串等等常量的定义，采用全大写字母，单词之间加下划线„_‟的方式命名  
2. 除了头文件或编译开关等特殊标识定义，宏定义不能使用下划线„_‟开头和结尾  
3. #include保护符开头与结尾都采用双下划线"__"中间使用头文件名,字符间使用“_”隔离 *如：\"api.h\"头文件保护符为\"\__API_H\__\"*

### 枚举的命名规则

1. 枚举的命名采用全大写字母，单词之间加“_”的方式命名  
2. 枚举中的成员命名采用枚举名加成员名，单词同样采用大写单词之间使用"_"方式  

## 变量  

1. 一个变量只用来表示一个特定功能，不能把一个变量作多种用途  
2. 结构体功能单一；不要设计面面俱到的数据结构  
3. 不用或者少用全局变量  
*说明：文件内部使用的全局变量使用static定义，尽量不将或少将全局变量extern出去*  
4. 使用面向接口编程思想，通过API访问数据：如果本模块的数据需要对外部模块开放，应提供接口函数来设置、获取，同时注意全局数据的访问互斥  

## 宏

1. 除非必要，应尽可能使用函数代替宏(中断函数除外)  
2. 常量建议使用const定义代替宏  
3. 宏定义中尽量不使用return、goto、continue、break等改变程序流程的语句  

## 注释  

*在代码的功能、意图层次上进行注释，即注释解释代码难以直接表达的意图，而不是重复描述代码。**最好的注释即为代码本身，尽量将代码函数名称与变量名称定义为符合阅读习惯，减少注释的使用。***  

1. 修改代码时，维护代码周边的所有注释，以保证注释与代码的一致性。不再有用的注释要删除  
2. 注释应放在其代码上方相邻位置或右方，不可放在下面。如放于上方则需与其上面的代码用空行隔开，且与下方代码缩进相同  
3. 对于switch语句下的case语句，如果因为特殊情况需要处理完一个case后进入下一个case处理，必须在该case语句处理完、下一个case语句前加上明确的注释，有效防止无故遗漏break语句  
4. 避免在注释中使用缩写，除非是业界通用或子系统内标准化的缩写  

## 排版与格式  

1. 程序块采用缩进风格编写，每级缩进为4个空格  
2. 相对独立的程序块之间、变量说明之后必须加空行  
3. 一条语句不能过长，如不能拆分需要分行写。一行以屏幕可已显示全为限制，且换行时建议一个完整的语句放在一行，不要根据字符数断行，换行时操作符应该也放下来，放在新行首  
4. 多个短语句（包括赋值语句）不允许写在同一行内，即一行只写一条语句  
5. 在两个以上的关键字、变量、常量进行对等操作时，它们之间的操作符之前、之后或者前后要加空格；进行非对等操作时，如果是关系密切的立即操作符（如->），后不应加空格  
    * 逗号、分号只在后面加空格
    * 比较操作符, 赋值操作符"="、 "+="，算术操作符"+"、"%"，逻辑操作符"&&"、"&"，位域操作符"<<"、"^"等双目操作符的前后加空格  
    * "!"、"~"、"++"、"--"、"&"（地址操作符）等单目操作符前后不加空格  
    * "->"、"."前后不加空格  
    * if、for、while、switch等与后面的括号间应加空格，使if等关键字更为突出、明显  
6. 在进行比较操作时，变量建议作为右值，常量作为左值，这样可以在编译时发现"=="被误写为"="的错误

## 代码整体层次性保证  

1. 只允许高层次代码(app层)调用低层次(服务层/驱动层)代码，不允许有反向依赖。
*如有底层次调用高层次需求，建议使用预设钩子函数，如：*

    ~~~c
    static void (*hookDeal)(uint8_t para_lens, uint8_t *para) = NULL;   //钩子函数入口地址

    //钩子函数绑定方法，供上层程序调用
    uint8_t bindHook(void(*recv)(uint8_t, uint8_t*)){
        bool state = false;
        if(NULL == hookDeal){
            hookDeal = (void *)recv;
            state = true;
        }
        return state;
    }

    //底层处理中需要将数据传输至高层次  
    void handle(){
    ...
    if(NULL != hookDeal){
        hookDeal(para_lens,&para)       //调用钩子函数
    }
    ...
    }

    ~~~

2. 一个函数中建议只有一处return，多个return会导致代码逻辑结构不清晰  

## 质量保证  

* 代码质量保证优先原则  
  * 正确性，指程序要实现设计要求的功能  
  * 简洁性，指程序易于理解并且易于实现  
  * 可维护性，指程序被修改的能力，包括纠错、改进、新需求或功能规格变化的适应能力  
  * 可靠性，指程序在给定时间间隔和环境条件下，按设计要求成功运行程序的概率  
  * 代码可测试性，指软件发现故障并隔离、定位故障的能力，以及在一定的时间和成本前提下，进行测试设计、测试执行的能力  
  * 代码性能高效，指是尽可能少地占用系统资源，包括内存和执行时间  
  * 可移植性，指为了在原来设计的特定环境之外运行，对系统进行修改的能力  
